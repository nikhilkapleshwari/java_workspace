package com.service;

import java.util.HashMap;
import java.util.Map;

import com.fasterxml.jackson.databind.JsonNode;
import com.model.User;
import com.util.JsonConverter;

public class AuthService {

	private static Map<String,String> userMap=new HashMap<String,String>();
	private static Map<String,String> signupMap=new HashMap<String,String>();
	
	static {
		userMap.put("admin","12345");
	}
	
	public static boolean addUser(final String userName,final String password) {
		if(userMap.containsKey(userName))
			return Boolean.FALSE;
		userMap.put(userName,password);
		signupMap.put(userName, AccountService.generatevCode());
		return Boolean.TRUE;
	}
	
	public static String getUser(final String userName) {
		return userMap.get(userName);
	}
	
	public static boolean validateUser(final String userName,final String password) {
		String dbPassword=userMap.get(userName);
		if(dbPassword==null || password==null)
			return Boolean.FALSE;
		return password.equals(dbPassword);
	}
	
	
	public static boolean deleteUser(final String userName) {
		if(userMap.containsKey(userName)) {
			userMap.remove(userName);
			return Boolean.TRUE;
		}
		return Boolean.FALSE;
	}
	
	public static boolean changePassword(final String userName,final String currentPassword,final String password) {
	
		if(AuthService.validateUser(userName, currentPassword)) {
			userMap.put(userName,password);
			return Boolean.TRUE;
		}
		return Boolean.FALSE;
	}
	
	public static User performValidation(String json) {
		JsonNode jsonNode = JsonConverter.getJsonNode(json);
		String userName = jsonNode.get("userName").textValue();
		String password = jsonNode.get("password").textValue();
		if(AuthService.validateUser(userName, password))
			return new User(userName,password,null);
		return null;
	}
	
	public static String generatevCode() {
		return "12345";
	}
}
